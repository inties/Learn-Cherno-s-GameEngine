# 模型渲染调试指南

## 问题现象
模型加载成功，但屏幕全黑，看不到模型。

## 已实现的调试工具

### 1. 调试着色器 (debug.glsl)
在 ImGui 界面中启用"Use Debug Shader"，可以切换到以下调试模式：

- **Solid Red**: 显示纯红色，确认顶点是否被处理
- **Position Colors**: 基于顶点位置生成颜色，查看模型形状
- **Normal Colors**: 显示法线作为颜色，检查法线数据
- **Texture Coords**: 显示纹理坐标，检查UV映射
- **Normal**: 正常纹理采样模式

### 2. ImGui 调试面板
查看以下信息：
- **Camera Info**: 相机位置和朝向
- **Model loaded**: 模型是否成功加载
- **Model Matrix[3]**: 模型位置信息
- **FPS**: 性能统计

### 3. 快速修复按钮
- **Reset Model Transform**: 重置模型变换
- **Reset to Default View**: 将模型移到 (0,0,-5) 并缩小到 0.1 倍

## 排查步骤

### 第一步：确认模型被渲染
1. 启用"Use Debug Shader"
2. 选择"Solid Red"模式
3. 如果看到红色形状 → 模型正在渲染，问题在材质/纹理
4. 如果仍然全黑 → 模型位置/相机问题

### 第二步：检查模型位置
1. 点击"Reset to Default View"按钮
2. 查看 ImGui 中的相机位置和模型矩阵位置
3. 调整"Scale"滑块（尝试 0.01 到 10）
4. 调整"Position"滑块

### 第三步：检查顶点数据
1. 使用"Position Colors"模式查看模型轮廓
2. 使用"Normal Colors"模式检查法线
3. 使用"Texture Coords"模式检查UV

### 第四步：检查相机设置
1. 确认相机不在模型内部
2. 检查 FOV、近远平面设置
3. 尝试调整相机位置

## 常见问题和解决方案

### 问题1: 模型太大或太小
**症状**: 调试模式显示红色但很小/很大的形状
**解决**: 调整 Scale 滑块，尝试 0.01-10 范围

### 问题2: 相机在模型内部
**症状**: 调试模式无任何显示
**解决**: 
- 设置模型位置为 (0, 0, -5)
- 或移动相机到模型外部

### 问题3: 深度测试问题
**症状**: 部分模型消失或闪烁
**解决**: 检查近远平面设置，确保模型在有效范围内

### 问题4: 纹理采样失败
**症状**: 调试模式正常，正常模式全黑
**解决**: 
- 检查纹理路径
- 确认纹理格式支持
- 检查着色器中的纹理 uniform

## 日志检查要点

查看控制台输出：
- `Successfully loaded DefaultPBR shader` - 着色器加载成功
- `Loaded texture: ... as uniform: ...` - 纹理加载成功
- `Successfully created shared VAO with ... vertices` - 几何数据成功
- `Debug rendered model with ... indices` - 调试渲染执行

## 代码修改建议

如果问题依然存在，可以尝试以下代码修改：

### 1. 强制设置相机位置
在 `RendererLayer::OnAttach()` 中添加：
```cpp
// 强制设置相机到安全位置
if (Application::Get().mainCam) {
    Application::Get().mainCam->SetPosition(glm::vec3(0, 0, 10));
    Application::Get().mainCam->SetFront(glm::vec3(0, 0, -1));
}
```

### 2. 添加日志输出
在 `RenderModelWithDebugShader()` 中添加：
```cpp
ENGINE_CORE_INFO("Model matrix: [{:.2f},{:.2f},{:.2f},{:.2f}]", 
    modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2], modelMatrix[3][3]);
ENGINE_CORE_INFO("Camera pos: ({:.2f},{:.2f},{:.2f})", 
    viewMatrix[3][0], viewMatrix[3][1], viewMatrix[3][2]);
```

### 3. 简化着色器测试
创建最简单的着色器只输出固定颜色：
```glsl
// Fragment shader
void main() {
    FragColor = vec4(1.0, 0.0, 0.0, 1.0); // 纯红色
}
```

通过这些调试工具和步骤，应该能够快速定位渲染问题的根源。